{% extends "base.html" %}

{% load bootstrap_toolkit %}

{% block title %}DB Viewer{% endblock %}

{% block extra_head %}

  <!--
  <script type="text/javascript" src="/static/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="/static/js/DT_bootstrap.js"></script>
  <link rel="stylesheet" href="/static/css/DT_bootstrap.css" type="text/css"/>
  -->
  <link rel="stylesheet" href="/static/css/jquery.dataTables.min.css" type="text/css"/>
  <link rel="stylesheet" href="/static/css/dataTables.tableTools.min.css" type="text/css"/>
  <link rel="stylesheet" href="/static/css/dataTables.editor.min.css" type="text/css"/>


  <script type="text/javascript" src="/static/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="/static/js/dataTables.tableTools.min.js"></script>
  <script type="text/javascript" src="/static/js/dataTables.editor.js"></script>
  <!-- <script type="text/javascript" src="/static/js/dataTables.editor.min.js"></script> -->

{% endblock %}

{% block content %}
<div class="row-fluid">
  &nbsp;
</div>

<div class="row-fluid">
  <div class="span10 offset1">

    <!-- Tab Headers: -->
    <ul class="nav nav-tabs" id="tabHeaders">
      <li class="active"><a href="#patientsPane" data-toggle="tab">Patients</a></li>
      <li><a href="#screensPane" data-toggle="tab">Screens</a></li>
      <li><a href="#samplesPane" data-toggle="tab">Samples</a></li>
      <li><a href="#sampleGroupsPane" data-toggle="tab">Screen Groups</a></li>
    </ul>

    <!-- Tab Content: -->
    <div class="tab-content">
      <div class="tab-pane active" id="patientsPane">
        <div class="well">
          <p></p>
            <!-- Patients Table -->
            <table class="table table-hover table-bordered roraTable display" id="patients_table" data-editor="patientEditor" data-subject="patient" cellspacing="0" width="100%">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>IDENTIFIER</th>
                  <th>SOURCE</th>
                  <th>DESCRIPTION</th>
                  <th>ORGANIZM</th>
                  <th>SEX</th>
                  <th>BIRTHDATE</th>
                  <th>USER_STAMP</th>
                  <th>TIME_STAMP</th>
                </tr>
              </thead>

              <tfoot>
                <tr>
                  <th>ID</th>
                  <th>IDENTIFIER</th>
                  <th>SOURCE</th>
                  <th>DESCRIPTION</th>
                  <th>ORGANIZM</th>
                  <th>SEX</th>
                  <th>BIRTHDATE</th>
                  <th>USER_STAMP</th>
                  <th>TIME_STAMP</th>
                </tr>
              </tfoot>

            </table>
            <!-- END OF Patients Table -->
        </div>
      </div>
      <div class="tab-pane" id="screensPane">
        <div class="well">
          <p></p>
            <!-- Screen Table -->
            <table class="table table-hover table-bordered roraTable display" id="screen_table" data-editor="screenEditor" data-subject="screen" cellspacing="0" width="100%">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>IDENTIFIER</th>
                  <th>DESCRIPTION</th>
                  <th>SOURCE</th>
                  <th>PATIENT</th>
                  <th>BREEZE_ALIAS</th>
                  <th>USER_STAMP</th>
                  <th>TIME_STAMP</th>
                </tr>
              </thead>

              <tfoot>
                <tr>
                  <th>ID</th>
                  <th>IDENTIFIER</th>
                  <th>DESCRIPTION</th>
                  <th>SOURCE</th>
                  <th>PATIENT</th>
                  <th>BREEZE_ALIAS</th>
                  <th>USER_STAMP</th>
                  <th>TIME_STAMP</th>
                </tr>
              </tfoot>

            </table>
            <!-- END OF Screen Table -->
        </div>
      </div>
      <div class="tab-pane" id="samplesPane">
        <div class="well">
          <p></p>
            <!-- Sample Table -->
            <table class="table table-hover table-bordered roraTable display" id="sample_table" data-editor="sampleEditor" data-subject="sample" cellspacing="0" width="100%">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>IDENTIFIER</th>
                  <th>DESCRIPTION</th>
                  <th>SCREEN</th>
                  <th>DOSAGE</th>
                  <th>USER_STAMP</th>
                  <th>TIME_STAMP</th>
                </tr>
              </thead>

              <tfoot>
                <tr>
                  <th>ID</th>
                  <th>IDENTIFIER</th>
                  <th>DESCRIPTION</th>
                  <th>SCREEN</th>
                  <th>DOSAGE</th>
                  <th>USER_STAMP</th>
                  <th>TIME_STAMP</th>
                </tr>
              </tfoot>

            </table>
            <!-- END OF Sample Table -->
        </div>
      </div>
      <div class="tab-pane" id="sampleGroupsPane">
        <div class="well">
          <p></p>
          <!-- ScreenGrops Table -->
            <table class="table table-hover table-bordered roraTable display" id="screenGroup_table" data-editor="groupEditor" data-subject="group" cellspacing="0" width="100%">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>USERNAME</th>
                  <th>GROUPNAME</th>
                  <th>USER_STAMP</th>
                  <th>TIME_STAMP</th>
                </tr>
              </thead>

              <tfoot>
                <tr>
                  <th>ID</th>
                  <th>USERNAME</th>
                  <th>GROUPNAME</th>
                  <th>USER_STAMP</th>
                  <th>TIME_STAMP</th>
                </tr>
              </tfoot>

            </table>
            <!-- END OF ScreenGrops Table -->
        </div>
      </div>
    </div>
    <!-- END OF Tab Content: -->

  </div>
</div>

<script>

$(document).ready(function() {
  // using jQuery
  function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie != '') {
          var cookies = document.cookie.split(';');
          for (var i = 0; i < cookies.length; i++) {
              var cookie = jQuery.trim(cookies[i]);
              // Does this cookie string begin with the name we want?
              if (cookie.substring(0, name.length + 1) == (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
  }
  var csrftoken = getCookie('csrftoken');
  var username = "{{ user.username|default:"undefined" }}"

  // --- SCREEN GROUPS Set Up ---
  // ----------------------------
  groupEditor = new $.fn.dataTable.Editor( {
        ajax: "/ajax-rora/action/group",
        table: "#screenGroup_table",
        "fields": [ {
                "label": "Group Name",
                "name": "group_name"
            }
        ]
    } );

  groupEditor.on( 'preSubmit', function ( e, data, action ) {
                data.csrfmiddlewaretoken = csrftoken;
                data.group_author = username;
        } );

  $('#screenGroup_table').DataTable( {
    dom: "Tlfrtip",
    retrieve: true,
    //"bDestroy": true,
    ajax: {
      url: "/ajax-rora-patients/" + $('#screenGroup_table').data('subject'),
      type: "GET"
    },
    serverSide: true,
    columns: [
            { data: "PK_SCREEN_GROUP_ID" },
            { data: "FIMM_USERNAME" },
            { data: "SCREEN_GROUP_NAME" },
            { data: "USER_STAMP" },
            { data: "TIME_STAMP" }
        ],
    tableTools: {
        sRowSelect: "multi",
        aButtons: [
            { sExtends: "editor_create", editor: groupEditor },
            { sExtends: "editor_edit",   editor: groupEditor },
            { sExtends: "editor_remove", editor: groupEditor }
        ]
    }
  } );  // #screenGroup_table

  // --- SAMPLES Set Up       ---
  // ----------------------------
  $('#sample_table').DataTable( {
    dom: "lfrtip",
    retrieve: true,
    //"bDestroy": true,
    ajax: {
      url: "/ajax-rora-patients/" + $('#sample_table').data('subject'),
      type: "GET"
    },
    serverSide: true,
    columns: [
            { data: "PK_SCREEN_SAMPLE_ID" },
            { data: "IDENTIFIER" },
            { data: "DESCRIPTION" },
            { data: "SCREEN_ID" },
            { data: "ORDER_NO" },
            { data: "USER_STAMP" },
            { data: "TIME_STAMP" }
        ]
  } );  // #sample_table

  // --- SCREENS Set Up       ---
  // ----------------------------
  $('#screen_table').DataTable( {
    // dom: "lfrtip",
    retrieve: true,
    //"bDestroy": true,
    ajax: {
      url: "/ajax-rora-patients/" + $('#screen_table').data('subject'),
      type: "GET"
    },
    serverSide: true,
    columns: [
            { data: "PK_SCREEN_ID" },
            { data: "IDENTIFIER" },
            { data: "DESCRIPTION" },
            { data: "SOURCE_IDENTIFIER" },
            { data: "ENTITY_ID" },
            { data: "BREEZE_ALIAS" },
            { data: "USER_STAMP" },
            { data: "TIME_STAMP" }
        ]
  } );  // #screen_table


  // --- PATIENTS Set Up ---
  // ----------------------------
  patientEditor = new $.fn.dataTable.Editor( {
        ajax: "/ajax-rora/action/",
        table: "#patient_table",
        //idSrc: "id",
        "fields": [
            { "label": "Identifier:",   "name": "IDENTIFIER",         "type": "text", "attr": { "required": true } },
            { "label": "Source:",       "name": "SOURCE_IDENTIFIER",  "type": "text", "def": "FIMM" },
            { "label": "Description:",  "name": "DESCRIPTION",        "type": "textarea" },
            { "label": "Organism:",     "name": "ORGANISM_ID",        "type": "select" },
            { "label": "Sex:",          "name": "SEX_ID",             "type": "select" },
            { "label": "Birth date:",   "name": "BIRTHDATE",          "type": "date",  "dateFormat": "yy-mm-dd", "opts": { "changeMonth": true, "changeYear": true }  }
        ]
    } );

  // Set field options:
  patientEditor.field('ORGANISM_ID').update( [ 'Homosapiens', 'Mouse'  ] );
  patientEditor.field('SEX_ID').update( [ 'Male', 'Female'  ] );

  // Supply additional parameters before Submit:
  patientEditor.on( 'preSubmit', function ( e, data, action ) {
                data.csrfmiddlewaretoken = csrftoken;
                data.group_author = username;
                data.table = 'patients';
        } );


  $('#patients_table').DataTable( {
    dom: "Tlfrtip",
    retrieve: true,
    //"bDestroy": true,
    ajax: {
      url: "/ajax-rora-patients/" + $('#patients_table').data('subject'),
      type: "GET"
    },
    serverSide: true,
    columns: [
            { data: "PK_ENTITY_ID" },
            { data: "IDENTIFIER" },
            { data: "SOURCE_IDENTIFIER" },
            { data: "DESCRIPTION" },
            { data: "ORGANISM_ID" },
            { data: "SEX_ID" },
            { data: "BIRTHDATE" },
            { data: "USER_STAMP" },
            { data: "TIME_STAMP" }
        ],
    tableTools: {
        sRowSelect: "multi",
        aButtons: [
            { sExtends: "editor_create", editor: patientEditor },
            { sExtends: "editor_edit",   editor: patientEditor },
            { sExtends: "editor_remove", editor: patientEditor }
        ]
    }
  } );  // #patients_table



});
</script>

{% endblock %}