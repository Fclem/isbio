<!DOCTYPE html>
{% load bootstrap_toolkit %}
<html lang="en">
<head id="html_header">
	<meta charset="utf-8">
	<title>{% block title %} {% endblock %} | {{ site_title_long }}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="shortcut icon" href="/static/img/favicon.ico"/>
	
	<!-- Rollbar -->
	<!--
	<script type="text/javascript">
		var _rollbarConfig = {
			accessToken: "5a228b54d0074cdda7951cd590d4fd74",
			captureUncaught: true,
			payload: {
				environment: "production"
			}
		};
	</script>
	<script src="/static/js/rollbar.js"></script>
	-->
	<!-- jQuery -->
	<script src="/static/js/jquery-1.8.3.min.js"></script>
	
	<!-- Bootstrap -->
	<script src="/static/js/bootstrap.min.js"></script>
	<script src="/static/js/bootbox.min.js"></script>
	<link href="/static/css/bootstrap.css" rel="stylesheet">
	<link href="/static/css/bootstrap-responsive.css" rel="stylesheet">
	
	<!-- jQuery ui -->
	<script src="/static/js/jquery-ui-1.9.2.custom.min.js"></script>
	<link href="/static/css/jquery-ui-1.9.2.custom.css" rel="stylesheet">
	
	<!-- jQuery modules -->
	<script src="/static/js/jquery.ajaxfileupload.js"></script>
	<script src="/static/js/jquery.MultiFile.js"></script>

	<!-- jQuery FileInput -->
	<script src="/static/third-party/jQuery-UI-FileInput/js/enhance.min.js" type="text/javascript"></script>
	<script src="/static/third-party/jQuery-UI-FileInput/js/fileinput.jquery.js" type="text/javascript"></script>
	<link href="/static/third-party/jQuery-UI-FileInput/css/enhanced.css" rel="stylesheet">

	<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

	<link href="/static/css/breeze-base.css" rel="stylesheet">
	<link href="/static/css/footer.css" rel="stylesheet">
	<style>
		.nav.pull-right .btn-group{
			margin-left: 20px;
		}
		.modal{
			z-index: 1110;
		}
	</style>
	
	<!-- Footnote as a real footer compatibility for IE<7 -->
	<!--[if lt IE 7]>
    <style type="text/css">
      #wrapper { height:100%; } /* Footnote as a real footer compatibility for IE<7 */
    </style>
    <![endif]-->

	<!-- AUTH0 include & init -->
	{% include "hello_auth/auth0.html" %}
	<script type="text/javascript">
		function logout_login() {
			$.get('/logout/login', function () {
				location.href = '/login_page?show_login';
			});
			
			return event.preventDefault();
		}
	</script>
	
	<!-- Extra head container, to be overridden by child pages -->
	{% block extra_head %}{% endblock %}
	
	{% if not request.user.is_guest %}
	<!-- bootstrap-tour -->
	<link href="/static/css/bootstrap-tour-standalone-custom.css" rel="stylesheet">
	<script src="/static/js/bootstrap-tour.min.js"></script>
	
	<!-- My tour for logged-in users -->
	<script type="text/javascript">
		$(function () {
			function switchToProjects(){
				$('#preferencesMenuLink').click();
				$('#projectsTabHeader').click();
			}
			function switchToGroups(){
				$('#preferencesMenuLink').click();
				$('#groupsTabHeader').click();
			}
			function switchToFeed () {
				$('#feedMenuLink').click();
			}
			
			var tourUsed = 0;
			var tour = new Tour({
				orphan: true,
				//storage: false,
				onEnd : function (tour) {
					document.getElementById("tour-button").classList.remove('disabled');
				},
				steps : [
					{
						title: "Welcome !",
						element  : "#tour-button",
						placement: "bottom",
						path     : "/home",
						content  : "Welcome to Breeze introduction tour.<br>" +
						"It will introduce you to the Breeze platform<br>" +
						"by walking you through it, step by step."
					},
					{
						title  : "Main page",
						path   : "/home",
						orphan : true,
						content: "This is the main page, here you will find updates about pipelines<br>" +
						"as well as all the customizations options of the platform"
					},
					{
						title  : "Personal information",
						path   : "/home",
						element: "#userInfoDiv",
						placement: "bottom",
						backdrop: true,
						content: "If you haven't done so yet, you can click here<br>to update your personal " +
						"information"
					},
					{
						title  : "Preferences",
						path   : "/home",
						element: "#preferencesMenuLink",
						placement: "right",
						content: "You may go here to use some customization features",
						duration: 4000,
						backdrop: true,
						onShow: switchToFeed,
						onNext: switchToProjects
					},
					{
						title  : "Projects",
						path   : "/home",
						element: "#projects_tab",
						placement: "bottom",
						content: "Here you can view, edit and create 'projects' that helps<br>with categorizing your"
						+ "reports for your own convenience.",
						backdrop: true,
						onPrev: switchToFeed,
						onShow: switchToProjects,
						onNext: switchToGroups
					},
					{
						title  : "Groups",
						path   : "/home",
						element: "#usergroups_tab",
						placement: "bottom",
						content: "Here you can view, edit and create 'projects' that helps<br>with categorizing your"
						+ "reports for your own convenience.",
						backdrop: true,
						onPrev: switchToProjects,
						onShow: switchToGroups
					},
					{
						title  : "Report page",
						path   : "/reports/",
						reflex : true,
						orphan : true,
						content: "This is the report page"
					}
				]
			});
			
			tour.init();
			{% if request.path == '/home/' %}
			var tourBouton = document.getElementById("tour-button");
			
			tourBouton.addEventListener("click", function () {
				tour.restart();
				tourUsed++;
				tourBouton.classList.add('disabled');
			}, false);
			{% endif %}
		});
	</script>
	{% endif %}
</head>
<body>
<div id="wrapper">
	<!--[if lt IE 9]>
      <link rel="stylesheet" type="text/css" href="/static/css/jquery.ui.1.9.2.ie.css"/>
      <![endif]-->
	<!-- error popup message placeholder -->
	<div id="popup_message_container">
		<div id="error_msg" class="alert alert-danger alert-dismissible hidden" role="alert">
			<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<strong><span id="error_msg_holder">{{ error_message|linebreaks }}</span></strong>
		</div>
	</div>
	<!-- /error popup message placeholder -->

	<!-- main navigation bar -->
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container-fluid">
				<a class="brand" href="/breeze/">{{ site_title }}</a>
				<div class="navbar-content" id="navbar-content">
					{% if user.is_authenticated %}
					<ul class="nav pull-right">
						{% if request.path == '/home/' %}
						<li><!-- tour button -->
							<div class="btn-group pull-right">
								<a id="tour-button" class="btn btn-inverse" href="#">
									<i class="icon-play icon-white"></i> Take the tour
								</a>
							</div>
						</li>
						{% endif %}
						<li><!-- user menu -->
							<div class="btn-group pull-right">
								<a class="btn btn-inverse dropdown-toggle" data-toggle="dropdown" href="#">
									<i class="icon-user icon-white"></i> {{ user.username }} <span
								  class="caret"> </span>
								</a>
								<ul class="dropdown-menu">
									{% if user.is_guest %}
									<li><a href="#" onclick="logout_login();"> Log in <i class="icon-share"></i></a></li>
									<li><a href="/logout/"> Destroy session <i class="icon-share"></i></a></li>
									{% else %}
									<li><a href="/logout/"> Log Out <i class="icon-share"></i></a></li>
									{% endif %}
								</ul>
							</div>
						</li>
					</ul>

					<ul class="nav" >
						<li class="{{ home_status }}{% if user.is_guest %} disabled{% endif %}">
							<a {% if not user.is_guest %} href="/home/"{% endif %}>
								<i class="icon-home"></i>
								Home</a>
						</li>
						<li class="{{ jobs_status }}">
							<a href="/jobs/" id="dash">
								<i class="icon-tasks"></i>
								Dash</a>
						</li>
						<li class="{{ scripts_status }}{% if user.is_guest %} disabled{% endif %}">
							<a {% if not user.is_guest %} href="/scripts/"{% endif %} id="scripts">
								<i class="icon-list-alt"></i>
								Scripts</a>
						</li>
						<li class="{{ reports_status }}">
							<a href="/reports/" id="reports">
								<i class="icon-th"></i>
								Reports</a>
						</li>
						<li class="{{ dbviewer_status }} disabled">
							<a href="#" id="db" disabled="disabled">
								<i class="icon-briefcase"></i>
								DB Viewer</a>
						</li>
						{% if is_local_admin %}
						<li class="{{ resources_status }}">
							<a href="/resources/" id="resources">
								<i class="icon-wrench"></i>
								Manage Resources</a>
						</li>
						{% endif %}
						<li class="{{ store_status }}{% if user.is_guest %} disabled{% endif %}">
							<a {% if not user.is_guest %} href="/store/" {% endif %} id="store">
								<i class=" icon-cog"></i>
								Markets </a>
						</li>
						<li class="{{ tools_status }}">
							<a href="/tools/" id="tools">
								<i class="icon-question-sign"></i>
								Tools</a>
						</li>
						<li class="{{ help_status }}">
							<a href="/help/" id="help">
								<i class="icon-question-sign"></i>
								Help</a>
						</li>
						<li> </li>
					</ul>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
	<!-- /main navigation bar -->

	<!-- global container under the nav-bar -->
	<div id="content" class="container-fluid">
		<!-- show messages here -->
		{% if messages %}
			<ul class="messages">
				{% for message in messages %}
					<li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
				{% endfor %}
			</ul>
		{% endif %}
		<div class="row-fluid" style="display: none;">&nbsp;</div>
		{% if run_mode == 'pharma' or run_mode == 'pharma_dev' %}
		<div class="row-fluid">
			<div class="span10 offset1 alert alert-info" style="padding-bottom: 12px;padding-top: 12px;">
				<h4 style="text-decoration: underline;padding-bottom: 8px;">Welcome to the new Breeze-Pharma !</h4>
				Looking for your old reports and data ? They will still be accessible for some time at the <a
			    href="https://breeze-oldph.fimm.fi"
			  rel="noreferrer">old breeze-pharma</a>, and further on from our backup upon request.
			</div>
		</div>
		{% endif %}
		{% if user.is_guest %}
		<div class="row-fluid">
			<div class="span10 offset1 alert alert-warning" style="padding-bottom: 12px;padding-top: 12px;">
				<h4 style="text-decoration: underline;padding-bottom: 8px;">Guest user warning :</h4>
				You are currently using Breeze as a guest, which means that your session, and any associated data will be destroyed after {{guest_expiry}} of inactivity.
			</div>
		</div>
		{% endif %}
		{% block content %}

		{% endblock %}
	</div>
	<!-- /global container -->

	{% include "footer.html" %}
</div>
{% if not disable_zopim %}
	{% block zopim %}
		<!--Start of Zopim Live Chat Script-->
		<script type="text/javascript">
			window.$zopim || (function (d, s) {
				var z = $zopim = function (c) {z._.push(c)}, $ = z.s =
				  d.createElement(s), e = d.getElementsByTagName(s)[0];
				z.set = function (o) {
					z.set.
					  _.push(o)
				};
				z._ = [];
				z.set._ = [];
				$.async = !0;
				$.setAttribute("charset", "utf-8");
				$.src = "//v2.zopim.com/?2fQMyVQQ1GO74NehJsG5a8uf8RiZXHfV";
				z.t = +new Date;
				$.
				  type = "text/javascript";
				e.parentNode.insertBefore($, e)
			})(document, "script");
			{% if user.is_authenticated %}
				$zopim(function () {
					$zopim.livechat.setName('{{ user.get_full_name }}');
					$zopim.livechat.setEmail('{{ user.email }}');
				});
			{% endif %}
		</script>
		<!--End of Zopim Live Chat Script-->
	{% endblock %}
{% endif %}
{% if not disable_google_analytics %}
	{% block google_analytics %}
		<!--Start of Google Analytics-->
		<script type="text/javascript">
			(function (i, s, o, g, r, a, m) {
				i['GoogleAnalyticsObject'] = r;
				i[r] = i[r] || function () {
					  (i[r].q = i[r].q || []).push(arguments)
				  }, i[r].l = 1 * new Date();
				a = s.createElement(o),
				  m = s.getElementsByTagName(o)[0];
				a.async = 1;
				a.src = g;
				m.parentNode.insertBefore(a, m)
			})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
			ga('create', 'UA-86239311-1', 'auto');
			ga('require', 'linkid');
			ga('send', 'pageview');
		</script>
		<!--End of Google Analytics-->
	{% endblock %}
{% endif %}
<script type="text/javascript">
	//Displays floating disposable error message box
	function ShowError(HtmlContent) {
		$("#error_msg").removeClass("hidden");
		//$("#error_msg").innerHTML = HtmlContent;
		if (HtmlContent !== "") {
			var x = document.getElementById("error_msg_holder");
			if (x !== undefined) {
				x.innerHTML = HtmlContent;
			}
		}
	}

	$(document).ready(function () {
		var x = document.getElementById("error_msg_holder");
		if (x.innerHTML !== "" && x.innerHTML !== "<p></p>") {
			ShowError("");
		}
	});

	function fixDropDownSub(item) {

	}

	function fixDropDown() {
		//drop down
		var el=$('button.dropdown-toggle');
		for (var i = 0; i < el.length; i++) {
			el.eq(i).on("click", function () {
				var tg = $(this);
				var btGrp = tg.parents('div.btn-group').first();
				var modal = tg.parents('div.modal-body').first();
				if (btGrp.hasClass('open')) {
					//modal.(modal.height() - 450);
					modal.height(modal.height() - 450);
				} else {
					modal.height(modal.height() + 450);
				}
			});
		}
	}

	// prevents click on a submit button
	function disableObj(name) {
		clkBtn = $('#' + name + '')[0];
		//protect from double submission while sending
		if (clkBtn !== undefined) clkBtn.disabled = true;
	}

	function enableObj(name) {
		clkBtn = $('#' + name + '')[0];
		if (clkBtn !== undefined) clkBtn.disabled = false;
	}

	function switchObj(name) {
		clkBtn = $('#' + name + '')[0];
		if (clkBtn !== undefined) clkBtn.disabled = !clkBtn.disabled;
	}
</script>
</body>
</html>
