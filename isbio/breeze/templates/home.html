{% extends "base.html" %}

{% load bootstrap_toolkit %}

{% block title %}Home{% endblock %}

{% block extra_head %}
<style>
  .thumbnails .span4:nth-child(3n+1) {
margin-left:0;
}

.widget .panel-body { padding: 0px; }
.widget .list-group { margin-bottom: 0; }
.widget .panel-title { display:inline }
.widget ul { list-style-type: none; }
.widget li.list-group-item {border-radius: 0;border: 0;border-top: 1px solid #ddd; margin-bottom: 15px; }
.widget li.list-group-item:hover { background-color: rgba(86,61,124,.1); }
.widget .mic-info { color: #666666;font-size: 11px; }
.widget .comment-text { font-size: 12px; }
</style>

{% endblock %}

{% block content %}
<div class="row-fluid">
  &nbsp;
</div>

<div class="row-fluid">
  <!-- USER INFO -->
  <div class="span3  offset1 ">
    <div class="row-fluid">
      <div class="span12 well">
        <img style="float: left; margin: 1px 11px 1px 19px; height: 72px; width: 72px;" src="/static/user.jpg" class="thumbnail img-rounded">
        <p> <strong>Welcome:</strong> </p>
        <p>@{{ user.username|default:"USER NAME" }} </br>
        <strong> {{ user.first_name|default:"FirtstN" }} {{ user.last_name|default:"LastN" }} </strong></p> </br>
        <a id="update_btn" href="#" data-toggle="modal" class="btn btn-mini btn-primary btn-block hcalls" data-target="#UpdateInfo"  data-param="/update-user-info/">
          Update Info
        </a>
      </div>
    </div>
    <!-- DASH -->
    <div class="row-fluid">
      <div class="span12 well">
        <a id="new_project_btn" href="#" class="btn btn-block hcalls" type="button" data-toggle="modal"  data-target="#NewProject"  data-param="/projects/create">
          <strong>&nbsp;Create Project</strong>
        </a>
        <a href="" class="btn btn-block" type="button">
          <strong>&nbsp;Create Group</strong>
        </a>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span12 well">
        <a href="/scripts" class="btn btn-large btn-block btn-primary" type="button">
          <strong><i class="icon-tasks icon-white"></i> &nbsp;Start New Job</strong>
        </a>
        <a href="/reports" class="btn btn-large btn-block btn-primary" type="button">
          <strong><i class="icon-th icon-white"></i> &nbsp;Build New Report</strong>
        </a>
        <a href="/help" class="btn btn-large btn-block btn-primary" type="button">
          <strong><i class="icon-question-sign icon-white"></i> &nbsp;How To Use BREEZE</strong>
        </a>
      </div>
    </div>
  </div>

  <div class="span7">



    <!-- STATISTICS / PROJECTS / GROUPS -->
    <div class="row-fluid">
      <div class="span 12">
        <div class="tabbable">
          <!-- Tabs' Header -->
          <ul class="nav nav-tabs">
            <li class="{{ f_tab }}"><a href="#feed_tab" data-toggle="tab">Feed</a></li>
            <li class="{{ s_tab }}"><a href="#statistics_tab" data-toggle="tab">Statistics</a></li>
            <li class="{{ p_tab }}"><a href="#projects_tab" data-toggle="tab">Projects</a></li>
            <li class="{{ g_tab }}"><a href="#groups_tab" data-toggle="tab">Groups</a></li>
          </ul>
          <!-- Tabs' Content -->
          <div class="tab-content">
            <!-- FEED -->
            <div id="feed_tab" class="tab-pane {{ show_feed }}">
              <div class="row-fluid">
                <div class="span 12">
                  <div class="panel panel-default widget">
                    <div class="panel-body">
                      <ul class="list-group">
                        {% for post in posts %}
                        <li class="list-group-item">
                          <i class="icon-comment"></i>&nbsp;
                          <a href="#">
                            {{ post.title }}
                          </a>
                          <div class="mic-info">
                            By: <a href="#">{{ post.author }}</a> {{ post.time }}
                          </div>
                          <div class="comment-text">{{ post.body }}</div>
                        </li>
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

            </div>
            <!-- DB STATISTICS -->
            <div id="statistics_tab" class="tab-pane {{ show_statistics }}">
              <div class="row-fluid">
                <div class="span 12">
                  <table class="table table-bordered table-condensed">
                    <tbody>
                      <tr class="warning"><td>&nbsp; <strong>Jobs running:</strong> <span class="badge badge-info pull-right">{{ dbStat.jobs_running }}</span>&nbsp; </td></tr>
                      <tr class="warning"><td>&nbsp; <strong>Jobs sheduled:</strong> <span class="badge badge-info pull-right">{{ dbStat.jobs_scheduled }}</span>&nbsp; </td></tr>
                      <tr class="warning"><td>&nbsp; <strong>Jobs in history:</strong> <span class="badge badge-info pull-right">{{ dbStat.jobs_history }}</span>&nbsp; </td></tr>
                      <tr class="info"><td>&nbsp; <strong>Scripts in db:</strong> <span class="badge badge-info pull-right">{{ dbStat.scripts_total }}</span>&nbsp; </td></tr>
                      <tr class="info"><td>&nbsp; <strong>Reports in db:</strong> <span class="badge badge-info pull-right">{{ dbStat.scripts_tags }}</span>&nbsp; </td></tr>
                      <tr class="info"><td>&nbsp; <strong>Instances in db:</strong> <span class="badge badge-info pull-right">9999</span>&nbsp; </td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <p><br>&nbsp;<br></p>
            </div>
            <!-- PROJECTS -->
            <div id="projects_tab" class="tab-pane {{ show_projects }}">
              <div class="row-fluid">
                <div class="span12">
                  <!-- PROJECTS: List -->
                  <table class="table table-striped table-hover" id="main_table">
                    <thead>
                      <tr>
                        <th>Public</th> <th>Name</th> <th>Manager</th> <th>View</th> <th>Edit</th> <th></th><th>Delete</th>
                      </tr>
                    </thead>
                    <tbody id="padination-content">
                      {% include "projects-paginator.html" %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- GROUPS -->
            <div id="groups_tab" class="tab-pane {{ show_groups }}">
              Groups
              <p><br>&nbsp;<br></p>
            </div>
          </div>
          <!-- END of Tabs' Content -->
        </div>
      </div>
    </div>



    <!-- HOUM NOTIFICATION ROW
    <div class="row-fluid">
      <div class="span12 alert alert-info">
        <p><strong>HUOM!</strong></p>
        <p align="justify">
          Please keep in mind that this is a BETA version, so it might be unstable. We strongly advise that you use any other browser
          (<a href="http://www.google.com/chrome/" target="_blank">Google Chrome</a>,
          <a href="http://www.mozilla.org/en-US/firefox/new/" target="_blank">Mozilla Firefox</a>,
          <a href="http://www.apple.com/safari/" target="_blank">Safari</a>) but Microsoft IE so far.

          For BUG Tracking reasons please make use of BREEZE GitHub
          <a href="https://github.com/findcomrade/isbio/issues" target="_blank">Issues Page</a>
          or contact us by dmitrii.bychkov(at)helsinki.fi.
          Any ideas regarding desirable improvements and enhancements are very welcome. Kiitos!
        </p>
      </div>
    </div>
    HOUM NOTIFICATION ROW -->

    <!-- <div id="chart" style="width:100%; height:400px;"></div> -->
  </div>


</div>

<!-- MODALs -->
<div id="NewProject" class="modal hide fade" role="dialog" aria-hidden="true" style="background: url('/static/nail.png');"></div>
<div id="EditProject" class="modal hide fade" role="dialog" aria-hidden="true" style="background: url('/static/nail.png');"></div>
<div id="ProjectInfo" class="modal hide fade" role="dialog" aria-hidden="true" style="background: url('/static/nail.png');"></div>
<div id="UpdateInfo" class="modal hide fade" role="dialog" aria-hidden="true" style="background: url('/static/nail.png');"></div>


<div id="DeleteItem" class="modal hide fade" role="dialog"  aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
    <h3 id="del_title"> </h3>
  </div>
  <div class="modal-body">
    <p> All related jobs and reports will be deleted as well! <br>Do you want to delete this project ?! </p>
  </div>
  <div class="modal-footer">
    <a id="del_item_btn" href="#" class="btn btn-danger" > Delete </a>
    <a href="#" class="btn btn-inverse" data-dismiss="modal" aria-hidden="true">Close</a>
  </div>
</div>

<script type="text/javascript">
  $(document).ready(function(){
    modalConnect();

    // Load Project Info into a modal via AJAX
    $(".pinfo").click(function(ev) {
      ev.preventDefault();
      var par = $(this).data("param");
      $("#ProjectInfo").load("/projects/view/"+par, function() {
        $(this).modal('show');
      });
      return false;
    });

  });
</script>

<script type="text/javascript">
function submitItemModalFormBind(url, modalID){
  $('#form_modal_apply').submit(function(ev){
    var formData = new FormData($('form')[0]);
    $.ajax({
      type: "POST",
      url: url,
      enctype: 'multipart/form-data',
      data: formData,
      success:function(response, textStatus, jqXHR){
        var form = $("#form_modal_apply_div", response);
        // form is returned if it is not valid. update modal with returned form
        // change this "if" to check for a specific return code which should be set in the view
        if ( form.html() ){  //update modal div
          $('#form_modal_apply_div').html(form);
          $(modalID).modal('show');
        }
        else{  // form is not returned if form submission succeeded
        // update the entire doc with the response, since we received a entire success page and we want to reload the entire page
          document.open();
          document.write(response);
          document.close();
          $(modalID).modal('hide');
        }
      },
      error: function (request, status, error) {
        // implement proper error handling
        // console.log(request.responseText);
      },
      cache: false,
      contentType: false,
      processData: false
    });  // end of $.ajax()

    return false;
  }); // submitItemModalFormBind(url, modalID)
}

function modalConnect(){
  // 'hcalls' Class - goes for home ajax callable elements
  var controls = $('.hcalls')  // [ "#update_btn", "#new_project_btn" ]

  $.each(controls, function(i,element){
    $(element).unbind('click');

    $(element).click(function(ev){
      ev.preventDefault();

      var par = $(this).data("param");
      var tar = $(this).data("target");
      $.get(par.toString(), function(results){
        $(tar).html(results);
        $(tar).modal('show');
        $(document).ready(function(){
          submitItemModalFormBind(url=par.toString(), modalID=tar);
        });

      }, "html");

      return false;
    });

  });

}
</script>
{% endblock %}