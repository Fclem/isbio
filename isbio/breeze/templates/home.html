{% extends "base.html" %}

{% load bootstrap_toolkit %}

{% block title %}Home{% endblock %} 

{% block extra_head %}
<style>
  .thumbnails .span4:nth-child(3n+1) {
margin-left:0;
}
</style>
    
{% endblock %}

{% block content %}
<div class="row-fluid">
  &nbsp;
</div>

<div class="row-fluid"> 
  <!-- USER INFO -->
  <div class="span3  offset1 ">
    <div class="row-fluid">
      <div class="span12 well">
        <img style="float: left; margin: 1px 11px 1px 19px; height: 72px; width: 72px;" src="/static/user.jpg" class="thumbnail img-rounded">
        <p> <strong>Welcome:</strong> </p>        
        <p>@{{ user.username|default:"USER NAME" }} </br> 
        <strong> {{ user.first_name|default:"FirtstN" }} {{ user.last_name|default:"LastN" }} </strong></p> </br>
        <a id="update_btn" href="#" data-toggle="modal" class="btn btn-mini btn-primary btn-block" data-target="#UpdateInfo"  data-param="/update-user-info/">
          Update Info
        </a> 
      </div>            
    </div>
    <!-- DASH -->
    <div class="row-fluid">
      <div class="span12 well">
        <a href="/scripts" class="btn btn-large btn-block btn-primary" type="button">
          <strong><i class="icon-tasks icon-white"></i> &nbsp;Start New Job</strong>
        </a>
        <a href="/reports" class="btn btn-large btn-block btn-primary" type="button">
          <strong><i class="icon-th icon-white"></i> &nbsp;Build New Report</strong>
        </a>
        <a href="/help" class="btn btn-large btn-block btn-primary" type="button">
          <strong><i class="icon-question-sign icon-white"></i> &nbsp;How To Use BREEZE</strong>
        </a>
      </div>
    </div>
  </div>   

  <div class="span7">
    
    <!-- DB STATISTICS -->
    <div class="row-fluid">
      <div class="span 12">
        <table class="table table-bordered table-condensed">
          <tbody>            
            <tr class="warning"><td>&nbsp; <strong>Jobs running:</strong> <span class="badge badge-info pull-right">{{ dbStat.jobs_running }}</span>&nbsp; </td></tr>
            <tr class="warning"><td>&nbsp; <strong>Jobs sheduled:</strong> <span class="badge badge-info pull-right">{{ dbStat.jobs_scheduled }}</span>&nbsp; </td></tr>
            <tr class="warning"><td>&nbsp; <strong>Jobs in history:</strong> <span class="badge badge-info pull-right">{{ dbStat.jobs_history }}</span>&nbsp; </td></tr>
            <tr class="info"><td>&nbsp; <strong>Scripts in db:</strong> <span class="badge badge-info pull-right">{{ dbStat.scripts_total }}</span>&nbsp; </td></tr>
            <tr class="info"><td>&nbsp; <strong>Reports in db:</strong> <span class="badge badge-info pull-right">{{ dbStat.scripts_tags }}</span>&nbsp; </td></tr>
            <tr class="info"><td>&nbsp; <strong>Instances in db:</strong> <span class="badge badge-info pull-right">9999</span>&nbsp; </td></tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- HOUM NOTIFICATION ROW -->
    <div class="row-fluid">
      <div class="span12 alert alert-info">
        <p><strong>HUOM!</strong></p>
        <p align="justify">
          Please keep in mind that this is a BETA version, so it might be unstable. We strongly advise that you use any other browser
          (<a href="http://www.google.com/chrome/" target="_blank">Google Chrome</a>, 
          <a href="http://www.mozilla.org/en-US/firefox/new/" target="_blank">Mozilla Firefox</a>, 
          <a href="http://www.apple.com/safari/" target="_blank">Safari</a>) but Microsoft IE so far.
        
          For BUG Tracking reasons please make use of BREEZE GitHub 
          <a href="https://github.com/findcomrade/isbio/issues" target="_blank">Issues Page</a> 
          or contact us by dmitrii.bychkov(at)helsinki.fi.
          Any ideas regarding desirable improvements and enhancements are very welcome. Kiitos! 
        </p>
      </div>  
    </div> 
             
    <!-- <div id="chart" style="width:100%; height:400px;"></div> -->     
  </div>

  
</div>

<!-- Update User Info - MODAL -->
<div id="UpdateInfo" class="modal hide fade" role="dialog"  aria-hidden="true" style="background: url('/static/nail.png');"></div>

<script type="text/javascript">
    $(document).ready(function() {
        modalConnect();
    });
    // $(document).ready(function() {
        // var chart1 = new Highcharts.Chart({
        // chart: {
            // renderTo: 'chart',
            // backgroundColor: 'transparent',
            // type: 'bar',
        // },
        // title: {
            // text: 'Fruit Consumption'
        // },
        // xAxis: {
            // categories: ['Apples', 'Bananas', 'Oranges']
        // },
        // yAxis: {
            // title: {
                // text: 'Fruit eaten'
            // }
        // },
        // series: [{
            // name: 'Jane',
            // data: [1, 0, 4]
        // }, {
            // name: 'John',
            // data: [5, 7, 3]
        // }]
    // });
// });
    $(function () {

        // Datepicker
        $('#datepicker').datepicker({
            inline: true,
            autoSize: true
        });
        
            
        // File input (using http://filamentgroup.com/lab/jquery_custom_file_input_book_designing_with_progressive_enhancement/)
        $('#file').customFileInput({ });
        
    });
    
    $("#test").click(function(){
        GetProgres();    
    });
</script>
<script type="text/javascript">    
function submitItemModalFormBind(url){
         $('#personal_form').submit(function(ev){
             var formData = new FormData($('form')[0]);
             $.ajax({
                type: "POST",
                url: url,
                enctype: 'multipart/form-data',
                data: formData,
                success:function(response, textStatus, jqXHR){
                     var form = $("#personal_form_div", response);
                     //form is returned if it is not valid. update modal with returned form
                     //change this "if" to check for a specific return code which should be set in the view
                     if (form.html()) {
                         $('#personal_form_div').html(form);
                         $("#UpdateInfo").modal('show');
                      }
                      else{                          
                        //update the entire document with the response received since we received a entire success page and we want to reload the entire page
                        document.open();
                        document.write(response);
                        document.close();
                        $("#UpdateInfo").modal('hide');
                        }
                },
                error: function (request, status, error) {
                            //implement proper error handling
                },
                cache: false,
                contentType: false,
                processData: false
                    });
             return false;
             });
}
function modalConnect()
        {
            $("#update_btn").unbind('click');
            $("#update_btn").click(function(ev) {
                ev.preventDefault(); 
                var par = $(this).data("param");
                $.get(par.toString(), function(results){
                  $('#UpdateInfo').html(results);
                  $("#UpdateInfo").modal('show');
                  $(document).ready(function () {
                     submitItemModalFormBind(par.toString());
                  });

                }, "html");
                return false;
            })
        }
</script>


{% endblock %}