{% extends "base.html" %}

{% load bootstrap_toolkit %}

{% block title %}{{ title }} :: Shiny{% endblock %}

{% block extra_head %}
	<style type="text/css">
		.span12, .span6{

		}
		iframe{
			width: 100%;
			height: 200px;
			max-height: inherit;
			max-width: inherit;
			border: 0px;
			resize: both;
		}
		.container-fluid{
			padding-left: 0px;
			padding-right: 0px;
		}
	</style>
{% endblock %}

{% block content %}

	<div class="row-fluid">
		<div class="span12" id="container">
					<iframe id="main" src="" seamless="seamless"></iframe>
		</div>
	</div>
	
	<!-- First Line -->
	<div class="row-fluid">
		<!-- 1. Left block -->
		<div class="span6">
			QC
			<div class="row-fluid">
				<div class="span6">
					<div id="1.1"  ></div>
				</div>
				<div class="span6">
					<div id="1.2"  ></div>
				</div>
			</div>
		</div>
		<!-- 1. Right block -->
		<div class="span6">
			Curve of dose response
			<div class="row-fluid">
				<div class="span6">
					<div id="1.3"  ></div>
				</div>
				<div class="span6">
					<div id="1.4"  ></div>
				</div>
			</div>
		</div>
	</div>
	<!-- Second Line -->
	<div class="row-fluid">
		<!-- 2. Left block -->
		<div class="span6">
			DSS top50
			<div class="row-fluid">
				<div class="span6">
					<div id="2.1"  ></div>
				</div>
				<div class="span6">
					<div id="2.2"  ></div>
				</div>
			</div>
			<div class="row-fluid">
				<div class="span6">
					<div id="3.1"  ></div>
				</div>
				<div class="span6">
					<div id="3.2"  ></div>
				</div>
			</div>
		</div>
		<!-- 2. Right block -->
		<div class="span6">
			Future genomics
			<div class="row-fluid">
				<div class="span6">
					<div id="2.3"  ></div>
				</div>
				<div class="span6">
					<div id="2.4"  ></div>
				</div>
			</div>
			<div class="row-fluid">
				<div class="span12">
					<div id="3.3"  ></div>
				</div>
			</div>
		</div>
	</div>


	<script type="text/javascript">
		var our_frame = null;
		var url = '';

		$(document).ready(function () {
			url = document.location.origin + '/shiny/all-in-one/';
			our_frame = document.getElementById('main');
			our_frame.onloadend = setTimeout("checkReady()",  150);
			our_frame.src = url;
		});

		function checkReady() {
			//console.log(our_frame.contentDocument.body);
			if (our_frame.contentDocument['body']==undefined || our_frame.contentDocument.body == null) {
				setTimeout("checkReady()", 500);
			}else {
				//our_frame.contentDocument.body.onchange = watch();
				watch();
			}
		}

		function watch(oldSize){
			console.log('watch');
			var s2 = 0;
			var o2 = our_frame.contentDocument.body;
			if(not_empty(o2, 'children')){
				o2 = o2.children[0];
				if (not_empty(o2, 'children')) {
					o2 = o2.children[0];
					if (o2 != undefined) {
						s2 = o2.innerHTML.length;
						console.log('oldSize=' + oldSize);
						console.log('s2=' + s2.toString());
						var size = our_frame.contentDocument.body.innerHTML.length;
						console.log('Bsize=' + size.toString());
						//o2.onPageChanged = watch(s2);// setTimeout("watch(" + s2 + ")", 500);
						if (size > 1056 && s2>78 && s2 != oldSize) {
							duplicate();

						}
						if (s2 == oldSize)  return;
						//return;
					}
				}
			}
			setTimeout("watch(" + s2 + ")", 250);//
		}

		function duplicate(){
			console.log('duplicate');
			var obj = our_frame.contentDocument.body.innerHTML;
			our_frame.visible = false;
			var target = document.getElementById('1.1');
			target.innerHTML = obj;
		}
		function not_empty(obj, prop_name){
			return obj!=undefined && obj[prop_name]!=undefined && obj[prop_name].length>0;
		}
	</script>
{% endblock %}