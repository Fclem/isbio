{% extends "base.html" %}

{% load bootstrap_toolkit %}

{% block title %}Reports{% endblock %} 

{% block extra_head %}

  <link href="/static/css/bootstrapSwitch.css" rel="stylesheet">
  <script src="/static/js/bootstrapSwitch.js"></script>
  
<style>
  .thumbnail {
      border-style: groove; 
      border-radius: 7px;
      background: url('/static/nail1.png');
  }

</style>

{% endblock %}

{% block content %}
  <!-- SEARCH BARS -->
  {% if search_bars %}
  <div class="row-fluid">
    <div class="span10 offset1">
      <ul class="breadcrumb pull-left" style="background-color: transparent;">
        <li><a href="/reports/">Reports</a> <span class="divider">/</span></li>
        <li class="active"> Search </li>
      </ul>
    </div>
  </div>
  
  <!-- DATASETS -->
  <div class="row-fluid">
    <div class="span4 offset1 alert alert-info">
      <h4>DB Search <span class="badge badge-info pull-right">{{ds_count}} instances</span> </h4>
      <hr />
      <form class="navbar-search" action="/reports/dataset" method="post">
        {% csrf_token %}
        <input type="text" class="search-query input-xlarge " placeholder="Search... ">
        <p>&nbsp; e.g. Sanger</p>
        <button type="submit" class="btn btn-info input-medium pull-left"><strong>Search</strong></button>
      </form>
    </div> 
    
    <!-- ENTITIES -->
    <div class="span6 alert alert-info">
      <h4>
        Entity Report Card 
        <span class="badge badge-info pull-right">0 tags</span> &nbsp; 
        <span class="badge badge-info pull-right">0 reports</span>
      </h4>
      <hr />
      <form class="navbar-search" action="/reports/entity" method="post">
        {% csrf_token %}
        <div class="controls">
          <input name="query" type="text" class="input-xlarge search-query" placeholder="Search... " value="{{ query_value }}">
          <select name="type" class="input-medium search-query">
            <option><strong>Drug</strong></option>
            <option><strong>Sample</strong></option>
            <option><strong>Patient</strong></option>
          </select>
          <p>&nbsp; e.g. Bosutinib</p>
          <button type="submit" class="btn btn-info input-medium pull-left"><strong> QUERY </strong></button>
        </div>
      </form>
    </div>
  </div>
  {% endif %}
  
  
  <!-- TABLE OF SEARCH RESULT -->
  {% if search_result %}
  <div class="row-fluid">
    <p>
      <br>&nbsp;<br>    
    </p>  
  </div>

  <div class="row-fluid">
    <div class="span8 offset2">
      <table class="table table-striped table-condensed table-hover">
        <tbody>
        {% for item in output %}
          {% if result_type == "entity" %}
          <tr>             
            <td>&nbsp; <a href="/reports/overview/{{ report_type }}-{{ item.name }}"> {{ item.name }} </a> </td>
            <td> {{ item.db }} </td>
          </tr>
          {% endif %}
          
          {% if result_type == "dataset" %}
          <tr>
            <td>&nbsp; <strong>{{ item.name|upper }}</strong>  </td>
            <td> <i>{{ item.description }}</i> </td>
            <td>
              <a class="btn btn-inverse pull-right" href="/get/dataset-{{ item.name }}"><i class="icon-white icon-download-alt"></i> <strong>Download</strong></a> 
            </td>
          </tr>
          {% endif %}
        {% empty %}
          <p>No results for your query!</p>
        {% endfor %}
        </tbody>
      </table>   
    </div>
  </div>
  {% endif %}
  
  <!-- REPORT OVERVIEW -->
  {% if overview %}
  <div class="row-fluid">
    <div class="span10 offset1">
      <ul class="breadcrumb pull-left" style="background-color: transparent;">
        <li><a href="/reports/">Reports</a> <span class="divider">/</span></li>
        <li><a href="/reports/">Search</a> <span class="divider">/</span></li>
        <li class="active"> Overview </li>
      </ul>
    </div>
  </div>
  
  <div class="row-fluid">
    <div class="span4 offset1">
      <div class="row-fluid thumbnail">
        <h5> {{ report_type }} Report </h5>
        <h3> {{ instance_name }} </h3>
        <p> (upon bioinformaticians) </p>
      </div>
      <div class="row-fluid">&nbsp;</div>
      <div class="row-fluid" align="center">
        <a href="/reports/overview/{{ report_type }}-{{ item.name }}-full" class="input-medium btn-large btn-primary" target="_blank"> <strong> Generate Report </strong></a>
      </div>
    </div>
      
    <div class="span6">
      <table class="table  table-condensed">
        <tbody>
          {% for item in tags_available %}
            <tr class="info">
              <!-- tag title -->
              <td> <strong>&nbsp;{{ item.name }}</strong> </td>
              <!-- tag options button -->
              <td> 
                <button id="{{ item.id }}_optbtn" disabled="disabled" type="button" class="btn btn btn-info pull-right" data-toggle="collapse" data-target="#{{ item.id }}_options"> 
                  <i class="icon-tags icon-white"></i> 
                </button> 
              </td>
              <!-- tag trigger -->
              <td>
                <div class="switch switch-small pull-right trigger" data-which="{{ item.id }}" data-on="primary" data-off="info" data-on-label="<i class='icon-ok icon-white'></i>" data-off-label="<i class='icon-remove icon-white'></i>">
                  <input type="checkbox">
                </div> 
              </td>
            </tr>
            <tr>
              <!-- tag options form (collapse) -->  
              <td>
                <div id="{{ item.id }}_options" class="collapse options"> 
                  <form class="form-inline">
                    {{ item.form|as_bootstrap:'inline' }}
                    <a type="button" href="#" class="btn">Configure</a>
                  </form>
                </div>
              </td>
              <td></td><td></td>
            </tr>
          {% empty %}
            <tr class="error"><td> <div align="center"> No tags available for this instance. </div> </td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}
  
  {% if full_report %}
  <div class="row-fluid">
    <div class="span10 offset1"></div>
      <h4>&nbsp;</h4>
    </div>
  </div>
  <div class="row-fluid">
    <div class="span10 offset1">
      <iframe src="/media/{{ report_html}}" frameborder="no" scrolling="auto" class="span10" style="width:100%;height:1100px"></iframe>
    </div>
  </div>
  {% endif  %}
  
<script>
$(document).ready(function() {
  //$('.options').collapse('hide');
});

$('.trigger').on('switch-change', function (e, data) {
    var value = data.value;
    var which = $(this).data("which");
    
    if (value){
        $("#"+which+"_optbtn").removeClass("btn-info").addClass("btn-primary").removeAttr("disabled");
    }
    else {
        $("#"+which+"_optbtn").removeClass("btn-primary").addClass("btn-info").attr("disabled", "disabled");
        //$("#"+which+"_options").collapse('hide');
    }
});
</script>
  
{% endblock %}